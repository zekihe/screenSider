<!DOCTYPE html>
<html>
    <body>
        <!-- 摄像头预览区域 -->
        <video id="preview" 
            autoplay 
            playsinline 
            style="width: 300px; height: 300px;"></video>
        
        <!-- 控制按钮 -->
        <button id="startBtn">开始录制</button>
        <button id="stopBtn" disabled>停止录制</button>

        <script>
            const { ipcRenderer } = require('electron');
            let mediaRecorder;
            let stream;

            // 1. 获取摄像头流并展示
            async function startCamera() {
                try {
                // 请求摄像头权限（{ video: true } 表示只启用摄像头）
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { width: 1280, height: 720 }, // 摄像头分辨率
                    audio: false // 暂时不录制音频，可按需开启
                });
                // 显示摄像头画面
                document.getElementById('preview').srcObject = stream;
                } catch (err) {
                console.error('无法访问摄像头：', err);
                }
            }

            // 2. 开始录制
            document.getElementById('startBtn').addEventListener('click', async () => {
                if (!stream) await startCamera();
                
                // 创建 MediaRecorder 实例（录制视频流）
                mediaRecorder = new MediaRecorder(stream, {
                mimeType: 'video/mp4' // 录制格式为 MP4
                });
                
                // 保存录制的视频数据
                const chunks = [];
                mediaRecorder.ondataavailable = (e) => chunks.push(e.data);
                
                // 完成录制后保存文件
                mediaRecorder.onstop = async () => {
                const blob = new Blob(chunks, { type: 'video/mp4' });
                const buffer = await blob.arrayBuffer();
                // 调用 Electron API 保存文件到本地（需主进程配合）
                ipcRenderer.send('save-video', Buffer.from(buffer));
                };

                mediaRecorder.start();
                document.getElementById('startBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;
            });

            // 3. 停止录制
            document.getElementById('stopBtn').addEventListener('click', () => {
                mediaRecorder.stop();
                stream.getTracks().forEach(track => track.stop()); // 停止摄像头
                document.getElementById('startBtn').disabled = false;
                document.getElementById('stopBtn').disabled = true;
            });

            // 初始化时启动摄像头预览
            startCamera();
        </script>
    </body>
</html>